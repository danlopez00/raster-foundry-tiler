sudo: required

language: scala

services:
  - docker

cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.sbt/boot/

script:
  - mkdir -p ${HOME}/.sbt
  - docker run -v ${HOME}/.ivy2:/root/.ivy2 -v ${HOME}/.sbt:/root/.sbt -v ${PWD}:/rf-tiler -w /rf-tiler/mosaic quay.io/azavea/scala:latest ./sbt test

before_deploy:
  - docker run -v ${HOME}/.ivy2:/root/.ivy2 -v ${HOME}/.sbt:/root/.sbt -v ${PWD}:/rf-tiler -w /rf-tiler/mosaic quay.io/azavea/scala:latest ./sbt assembly
  - sudo chown ${USER} mosaic/target/scala-2.10/rf-tiler-assembly-${TRAVIS_TAG}.jar

deploy:
  provider: s3
  access_key_id:
    secure: snXHiFsDU+5OntZFQQGI4om8s9YkSG3/f2KwJxbanW4LQQUeKgSw8HfLK6ADNHxU+OsNfDpV+QgNYtwn0Z24bWdfg5epPhJNW9lAWaA08LwZh4aVFXX31Ifef6kNy9yw07LXz7YjgrZIKgsRnWQ7WvRg66kQyOIcF7lJ9ZxP9X3doHJZjA44ivv7OdkElmwOtiV1XK3Zr4zVNZ1y5+6nRteDY/2UoI1gCc7CNuAQrVFqQbcBB5GWoAceqCprX+r7k+7gq8axvARonRpeUQVlc4gRypLSorIkpm2vVZhsxRUWdMbHm7mSH0zyKXOXeyuEUauM9sCHY6m9VB7MPjcLSV/+vjd7Jetv1bll7FY54GPkdIlKo3aJahP2rbxh8JH7d2F/qhSbSOUAis3OvRD0KrF6ykxJXZWjZ7DU6oVPE5pbGIYn1wHnAdJ4Col2NLc/5TO39Mg0p2rdG3HTZ5wu1fWaVeoZ3A3fWlasXQ7peKLG1l9fXUiZHG3rMUjjDmTNlx1REOUOQaSGqbDbP4Qdc9+8dVNTJybsf43TeTwbxrLcuk9paOBpiCEcbey3sD57uJoNpmG9uIlhnfcXQj1YjXZ5nIxDOw6jOiaFIkJE6AD/AvCEX8rEUxk8hdVvGSSgORWV27aXHUIeMZMDcZuCL2wIXFxbWO/Qs0aaAoBCIMs=
  secret_access_key:
    secure: l6yIOqnlN2AFGyssixuqL5Lg7jdymgOFXPLpyZEPQa7De0LwECBBBQYx6LHJCodlRA8KzLoP7JKeleFwu047H42DqsRiYWCuvRXsYu0C75CXdSsTnfKBf9UHQ3r3nY3y1ImFsWKWZR0qHvx0JBLzfoHSwu0v5h4xX4CqZ/6i6STOnSww0ZGpMg1gnk/vuvjkMwb3SvXthENvUQppiG5l14wgh4ZVGMtoJLnRtsEliliw5J5rZv70SPilpnkcp9MISaZEBFog+FqYSBrrXdAhoHnkfTNcvY8Rs5STqXr5HEmdxQH1OHIsuf1UjmoCCRS10ta4Gm2tPbIpjH8MQtRPBmk2pXdnV95moLa4AxWN2+1c0EvnkXd/euSYYGxIVpJ/XPOD+v4iqvAc3/Ydc46d66IpD9+pKoO94XdcYrcRqpIVvuVRQ75tZwQLgy4GcxbuhPmObt7Fe/Fe3fyEl3O5fn3t7rscfkEekSdY3HxrFP5gfFfVzhQjCd+q3JXJQAVQwcqfdLFwOCF1nqd7wz+P38lovNLKeD/6VecEZPgfeHyWLXjz8OWxmM5nYXKi1THopJahWRHsN5posfxSdMyTK5bz39nWxglTokGsqVqwE5G+MfjCxF7GReF1ikZLh2Sg2aXhZvEw0Ql1EiQipbiK73BQTlKljT91c20Sc9w1O7Q=
  bucket: raster-foundry-releases
  local_dir: mosaic/target/scala-2.10
  upload-dir: ${TRAVIS_TAG}
  skip_cleanup: true
  on:
    repo: azavea/raster-foundry-tiler
    tags: true
